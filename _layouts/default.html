---
# Default Template for Crystal Down
layout: compress
---
<!DOCTYPE html>
<html lang="{{ page.lang }}">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#007bff">
    {% assign title = page.title | append: " | " | append: site.title %}
    <title>{{ title | truncate: 67, "…" }}</title>
    <meta name="generator" content="Jekyll v{{ jekyll.version }}">
    {% capture css %}/assets/css/default{% 
      if page.additional_css
        %}+{{ page.additional_css | join: '+'}}{% 
      endif %}.css{% endcapture %}
    {% assign css_page = site.pages | where: 'url', css | last %}
    <link rel="stylesheet" type="text/css" href="{{ css }}?{{ css_page.content | sha256_64 | slice: 0, 5 }}">
    {% capture js %}/assets/scripts/default.js{% endcapture %}
      {% assign js_page = site.pages | where: 'url', js | last %}
    <script defer src="{{ js }}?{{ js_page.content | sha256_64 | slice: 0, 5 }}" crossorigin="anonymous"></script>
    {% if page.additional_js == "hyphenate" %}
    <script defer src="/assets/vendor/hyphenopoly/Hyphenopoly_Loader.js" crossorigin="anonymous"></script>
    {% endif %}
      <!-- Social Media Common -->
    {% if page.type == "chapter" %}
      <meta
        property="og:title" name="twitter:title"
        content="{{ site.title }} {{ page.book.number }}-{{ page.chapter }}: {{ page.title }}">
    {% else %}
      <meta
        property="og:title" name="twitter:title"
        content="{{ page.title }} | {{ site.title }}">
    {% endif %}
    <link rel="shortcut icon" href="{{ "/favicon.ico" | absolute_url }}">
    <link rel="apple-touch-icon" href="{{ "/assets/images/site-icon.png" | absolute_url }}">
    <!-- Social Networks -->
    <meta
      property="og:image"
      content="{{ page.image | absolute_url }}">
    <meta
      name="twitter:image"
      content="{{ page.image | replace: "og", "card" | absolute_url }}">
    {% capture description %}
      {{ page.excerpt | markdownify | strip_html }}
      {% unless page.excerpt %}{{ page.content | liquify | markdownify | strip_html }}{% endunless %}
    {% endcapture %}
    {% assign description_social_words = description | truncate: 200 | split: " " | size %}
    {% assign description_google_words = description | truncate: 160 | split: " " | size %}
    <meta
      property="og:description"
      name="twitter:description"
      content="{{ description | truncatewords: description_social_words, "…" }}">
    <meta
      name="description"
      content="{{ description | truncatewords: description_google_words, "…" }}">
    <!-- Twitter -->
    {% if site.twitter %}
    <meta name="twitter:card" content="{{ site.twitter.card }}">
    {% if site.twitter.creator %}
    <meta name="twitter:creator" content="@{{ site.twitter.creator }}">
    {% endif %}
    <meta name="twitter:site" content="@{{ site.twitter.username }}">
    {% endif %}
    {% if site.facebook %}
    <!-- Facebook -->
    <meta property="article:publisher" content="{{ site.facebook.publisher }}">
    <meta property="fb:app_id" content="{{ site.facebook.app_id }}">
    {% endif %}
    <meta property="og:url" content="{% if page.shortlink %}{{ page.shortlink }}{% else %}{{ page.url | absolute_url }}{% endif %}">
    <meta property="og:type" content="article">
    <!-- Search Engine Verification -->
    {% for pair in site.webmaster_verifications %}
    <meta 
      name="{{ pair.name }}"
      content="{{ pair.key }}">
    {% endfor %}
    {% if page.published == true %}
        {% if page.layout == "schema" %}
        <link rel="canonical" href="{{ site.shorturl }}{{ page.url }}">
        {% endif %}
    <link rel="canonical" href="{{ page.url | absolute_url }}">
    {% endif %}
    {% if page.shortlink %}
      <link rel="shortlink" href="{% if site.shorturl %}{{ site.shorturl }}{{ page.shortlink }}{% else %}{{ page.shortlink | absolute_url }}{% endif %}">
    {% endif %}
    <link
      rel="home alternate"
      type="application/rss+xml"
      title="{{ site.name }}"
      href="{{ "/feeds/chapters.xml" | absolute_url }}">
    {% if page.robots %}
      <meta name="robots" content="{{ page.robots }}">
    {% endif %}
    <noscript>
      <style>
        .interface .interface > p:first-of-type ~ *,
        .top-toggle > p:first-of-type ~ * {
          display: block !important;
        }
      </style>
    </noscript>
  </head>
  <body class="dark-theme" id="body">
    <div id="fb-root"></div>
    {% if site.about and site.about.type %}
    <script type="application/ld+json">
      {
        "@context": "https://schema.org/",
        "@type": "{{ site.about.type }}",
        "name": "{{ site.title }}",
        "url": "{{ site.url }}"{% if site.about.links %},
        "sameAs": [
          {% if site.about.links %}
            {{ site.about.links | jsonify }}
          {% endif %}
        ]{% endif %}
      }
   </script>
   {% endif %}
    <header aria-flowto="content" id="mobile-top">
      {% include base/header.html %}
    </header>

{% unless page.disable_sidebar %}
{% if false %}
    <div class="breadcrumbs">
      {% include base/breadcrumbs.html %}
    </div>
{% endif %}

    <nav>
      {% include base/navigation.html %}
    </nav>

    <div class="controls buttons">
      {% include base/controls.html %}
    </div>
{% endunless %}
    <main id="content" class="{{ page.layout }}">
      {{ content }}
    </main>

    <footer>
      <div id="support">
        {% include base/support.html %}
      </div>
      <div id="footer">
        {% include base/footer.html %}
      </div>
    </footer>

{% unless page.layout == "schema" %}
    <div class="policy-banner" id="policy-banner" data-nosnippet>
      {% include base/policy-banner.html %}
    </div>

    {% if page.comments %}
      {% include base/comments.html %}
    {% endif %}

    <script>
      window['pageType'] = '{{ page.type }}';
      window['analytics'] = '{{ site.google_analytics }}';
      {% if page.additional_js == "hyphenate" %}
      var Hyphenopoly = { require: { 
         "en-ca": "Supercalifragilisticexpialidocious"
        } };
      {% endif %}
    </script>
{% endunless %}
  </body>
</html>
